!function(l){"use strict";l.ToggleMenuPush=function(e,t){return this.toggleMenu=e,l.extend(l.ToggleMenuPush.prototype,l.ToggleMenu.prototype),l.extend(!0,this.settings={},this.toggleMenu.settings,l.ToggleMenuPush.defaults,t),this.elements=l.extend(!0,{body:l("body")},this.settings.elements),delete this.settings.elements,this.events={},this.isOpen=!1,this.level=0,this.prepareUserOptions()&&this.load(),this},l.ToggleMenuPush.defaults={elements:{content:{menu:void 0},items:void 0,itemLink:function(e){return e.children("a")},itemContent:function(e){return e.children("ul")},toggle:void 0,page:void 0,back:void 0,backBtn:function(e){return e.children("button")}},layout:"accordion",slideDuration:200,backLink:!1,classes:{submenuOpen:"is-{prefix}-submenu-open",copy:"{prefix}-copy",back:"item-back"},beforeLoad:void 0,beforeWrap:void 0,onAddContent:void 0,afterEventsHandler:void 0,afterItemHandler:void 0,onAddItemContent:void 0,onComplete:void 0,onToggle:void 0,onToggleSubmenu:void 0},l.ToggleMenuPush.prototype={prepareUserOptions:function(){return this.replacePrefixClass(),void 0===this.getElements().toggle&&(this.elements.toggle=l("."+this.settings.classes.prefix+"-toggle"),0===this.getElements().toggle.length)?(this.setLog("Missing elements.toggle parameter","error"),!1):void 0===this.getContentElements().menu?(this.setLog("Missing elements.content.menu parameter","error"),!1):void 0!==this.getElements().page||(this.elements.page=this.getElements().body.children("div:first"),0!==this.getElements().page.length)||(this.setLog("Missing elements.page parameter","error"),!1)},load:function(){return void 0!==this.settings.beforeLoad&&this.settings.beforeLoad.call({toggleMenuPush:this}),this.wrap(),this.addContent(),this.eventsHandler(),this.itemsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({toggleMenuPush:this,elements:this.getElements()}),this},unload:function(){var s=this;return s.isOpen&&s.toggle(),s.unWrap(),l.each(s.events,function(e,t){void 0!==s.getElements()[e]&&s.getElements()[e].off(t)}),s.getElements().items.each(function(e,t){t=l(t),s.getElements().itemLink(t).off("click.togglemenuPush"),void 0!==s.getElements().back&&s.getElements().backBtn(t).off("click.togglemenuPush")}),l.each(s.getContentElements(),function(e,t){"close"!==e&&t.removeClass(s.settings.classes.copy)}),s},wrap:function(){return this.elements.wrapper=l("<nav>",{class:this.settings.classes.prefix+" "+this.settings.classes.prefix+"--"+this.toggleMenu.menu.current}),void 0!==this.settings.beforeWrap&&this.settings.beforeWrap.call({toggleMenuPush:this,wrapper:this.getWrapper()}),this.getWrapper().appendTo(this.getElements().body),this},unWrap:function(){return this.getWrapper().remove(),this},addContent:function(){var n=this;return l.each(n.getContentElements(),function(e,t){var s=null;"close"===e?s=l("<button>",{html:t}):"object"==typeof t&&t.length&&((s=t.clone()).removeAttr("id"),t.addClass(n.settings.classes.copy)),null!=s&&(s.appendTo(n.getWrapper()),s.wrap(l("<div>",{class:n.settings.classes.prefix+"-"+e})),"close"!==e&&"menu"!==e||(n.elements[e+"Content"]=s,n.elements[e]=s.parent()),"menu"===e&&(void 0===n.getElements().items?n.elements.items=n.getItemsParent(s.find("li")):"function"==typeof n.getElements().items&&(n.elements.items=n.getElements().items(s)))),void 0!==n.settings.onAddContent&&n.settings.onAddContent.call({toggleMenuPush:n,type:e,element:t,content:s,contentWrapper:n.getElements()[e]})}),n},eventsHandler:function(){var e=this;return e.getElements().toggle.on(e.events.toggle="click.togglemenuPush",{self:e},e.toggle),void 0!==e.getElements().closeContent&&e.getElements().closeContent.on(e.events.closeContent="click.togglemenuPush",{self:e},e.toggle),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({toggleMenuPush:e,elements:e.getElements(),events:e.events}),e},itemsHandler:function(){var i=this;return i.getElements().items.length&&(i.getElements().items.each(function(e,n){(n=l(n)).layout=i.getItemLayout(n),n.addClass("l-"+n.layout),n.addClass(i.settings.classes.active),i.addItemContent(n),i.getElements().itemLink(n).on("click.togglemenuPush keydown.togglemenuPush",function(e){var t,s;e.preventDefault(),"keydown"===e.type&&"Tab"===e.key?!(t=n[e.shiftKey?"prev":"next"]()).length||(s=i.getElements().itemLink(t)).length&&s.focus():("click"===e.type||"keydown"===e.type&&"Enter"===e.key)&&i.toggleSubmenu(n)}),void 0!==i.settings.afterItemHandler&&i.settings.afterItemHandler.call({toggleMenuPush:i,elements:i.getElements(),item:n})}),i.closeSubmenus()),i},getItemLayout:function(e){if("data"!==this.settings.layout||void 0===e)return this.settings.layout;var t=void 0!==e.layout?e.layout:e.attr("data-layout");return void 0!==t||""!==t?t:l.ToggleMenuPush.defaults.layout},addItemContent:function(e){var t,s,n=this;return"panel"===e.layout&&(t=null,void 0!==n.getElements().back?t=n.getElements().back:(t=l("<li>",{class:n.settings.classes.back}),l("<button>",{class:"item-btn"}).appendTo(t),s=l("<span>",{class:"item-title",html:n.getElements().itemLink(e).text()}).appendTo(t),n.settings.backLink&&s.wrapInner(l("<a>",{href:n.getElements().itemLink(e).attr("href")}))),null!==t&&(t.prependTo(n.getElements().itemContent(e)),n.getElements().backBtn(t).on("click.togglemenuPush",function(){n.toggleSubmenu(e)}),void 0!==n.settings.onAddItemContent&&n.settings.onAddItemContent.call({toggleMenuPush:n,item:e,itemContent:t}))),n},toggle:function(e){var t=void 0!==e&&void 0!==e.data&&void 0!==e.data.self?e.data.self:this;return t.getElements().body.toggleClass(t.settings.classes.open),t.isOpen=t.getElements().body.hasClass(t.settings.classes.open),t.isOpen||(t.level=0),t.onReady(function(){t.isOpen?(t.getElements().page.on(t.events.page="click.togglemenuPush touchstart.togglemenuPush",function(e){e.preventDefault(),t.isOpen&&(t.getElements().toggle.focus(),t.toggle())}),setTimeout(function(){void 0!==t.getElements().closeContent&&t.getElements().closeContent.length?t.getElements().closeContent.focus():t.getElements().menuContent.length&&t.getElements().menuContent.find("a:first").focus()},100)):(t.getElements().page.off(t.events.page),t.getElements().toggle.focus(),t.closeSubmenus())}),void 0!==t.settings.onToggle&&t.settings.onToggle.call({toggleMenuPush:t,elements:t.getElements(),isOpen:t.isOpen}),t},toggleSubmenu:function(e){var t,s,n,i;return this.closeSubmenus(e),e.toggleClass(this.settings.classes.active),this.level=e.hasClass(this.settings.classes.active)?this.level+1:this.level-1,0<this.level&&this.level===this.getElements().menuContent.find("."+this.settings.classes.active).length&&(e.hasClass(this.settings.classes.active)?e.addClass(this.settings.classes.current):(t=e.closest("."+this.settings.classes.active)).length&&t.addClass(this.settings.classes.current)),"accordion"===this.getItemLayout(e)&&((s=this.getElements().itemContent(e)).slideToggle(this.settings.slideDuration),s.parent().hasClass(this.settings.classes.active)&&s.find("a:first").focus()),"panel"===this.getItemLayout(e)&&(this.getWrapper().scrollTop(0),this.getElements().body.removeClass(this.settings.classes.submenuOpen),0<this.level&&this.getElements().body.addClass(this.settings.classes.submenuOpen),e.hasClass(this.settings.classes.active)?!(n=e.find("."+this.settings.classes.back).eq(0)).length||(i=this.getElements().backBtn(n)).length&&i.focus():this.getElements().itemLink(e).focus()),void 0!==this.settings.onToggleSubmenu&&this.settings.onToggleSubmenu.call({toggleMenuPush:this,item:e}),this},closeSubmenus:function(e){var t,s,n=this,i=[];return(i=void 0!==e?(t=e.siblings("."+n.settings.classes.active),s=e.find("."+n.settings.classes.active),t.length&&i.push(t[0]),s.length&&i.push(s[0]),l(i)):n.getElements().items).removeClass(n.settings.classes.active),n.getElements().items.removeClass(n.settings.classes.current),i.each(function(e,t){t=l(t),"accordion"===n.getItemLayout(t)&&n.getElements().itemContent(t).slideUp(n.settings.slideDuration)}),n}}}(jQuery);