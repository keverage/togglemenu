!function(e){"use strict";e.ToggleMenuPush=function(t,s){this.ToggleMenu=t,e.extend(!0,this.settings={},this.ToggleMenu.settings,e.ToggleMenuPush.defaults,s),this.elements=this.settings.elements,delete this.settings.elements,this.events={},this.isOpen=!1,this.prepareOptions()&&this.load()},e.ToggleMenuPush.defaults={elements:{content:{menu:void 0},items:void 0,itemLink:function(e){return e.children("a")},itemContent:function(e){return e.children("ul")},toggle:void 0,page:void 0,back:void 0,backBtn:function(e){return e.children("button")}},layout:"accordion",backLink:!1,classes:{open:"is-{prefix}Open",submenuOpen:"is-{prefix}SubmenuOpen",active:"is-active",copy:"{prefix}-copy",back:"item-back"},onLoad:void 0,beforeWrap:void 0,onAddContent:void 0,afterEventsHandler:void 0,afterItemHandler:void 0,onAddItemContent:void 0,onComplete:void 0,onToggle:void 0,onToggleSubmenu:void 0},e.ToggleMenuPush.prototype={prepareOptions:function(){return this.ToggleMenu.replacePrefixClass.call(this),void 0===this.elements.toggle&&(this.elements.toggle=e("."+this.settings.classes.prefix+"-toggle"),0===this.elements.toggle.length)?(this.ToggleMenu.setLog("error","Missing elements.toggle parameter"),!1):void 0===this.elements.content.menu?(this.ToggleMenu.setLog("error","Missing element.content.menu parameter"),!1):void 0!==this.elements.page||(this.elements.page=this.ToggleMenu.elements.body.children("div:first"),0!==this.elements.page.length)||(this.ToggleMenu.setLog("error","Missing element.page parameter"),!1)},load:function(){void 0!==this.settings.onLoad&&this.settings.onLoad.call({ToggleMenuPush:this}),this.wrap(),this.addContent(),this.eventsHandler(),this.itemsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({ToggleMenuPush:this,elements:this.elements,wrapper:this.elements.wrapper})},wrap:function(){this.elements.wrapper=e("<nav>",{class:"nav nav--"+this.settings.classes.prefix+"Push"}),void 0!==this.settings.beforeWrap&&this.settings.beforeWrap.call({ToggleMenuPush:this,wrapper:this.elements.wrapper}),this.elements.wrapper.appendTo(this.ToggleMenu.elements.body)},unWrap:function(){this.elements.wrapper.remove()},addContent:function(){var t=this;e.each(t.elements.content,function(s,n){var i=null;"close"===s?i=e("<button>",{html:n}):"object"==typeof n&&n.length&&((i=n.clone()).removeAttr("id"),n.addClass(t.settings.classes.copy)),void 0!==i&&null!==i&&(i.appendTo(t.elements.wrapper),i.wrap(e("<div>",{class:t.settings.classes.prefix+"-"+s})),"close"!==s&&"menu"!==s||(t.elements[s+"Content"]=i,t.elements[s]=i.parent()),"menu"===s&&(void 0===t.elements.items?t.elements.items=t.ToggleMenu.getItemsParent(i.find("li")):"function"==typeof t.elements.items&&(t.elements.items=t.elements.items(i)))),void 0!==t.settings.onAddContent&&t.settings.onAddContent.call({ToggleMenuPush:t,type:s,element:n,content:i,contentWrapper:t.elements[s]})})},eventsHandler:function(){var e=this;e.elements.toggle.on(e.events.toggle="click.togglemenu.toggle",function(){e.toggle()}),void 0!==e.elements.closeContent&&e.elements.closeContent.on(e.events.closeContent="click.togglemenu.close",function(){e.toggle()}),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({ToggleMenuPush:e,elements:e.elements,events:e.events})},itemsHandler:function(){var t=this;t.elements.items.length&&t.elements.items.each(function(){var s=e(this);s.layout=t.getItemLayout(s),s.addClass("l-"+s.layout),t.addItemContent(s),t.elements.itemLink(s).on("click.togglemenu.itemLink",function(e){e.preventDefault(),t.toggleSubmenu(s)}),void 0!==t.settings.afterItemHandler&&t.settings.afterItemHandler.call({ToggleMenuPush:t,elements:t.elements,item:s})})},getItemLayout:function(t){if("data"===this.settings.layout&&void 0!==t){var s=t.attr("data-layout");return void 0!==s||""!==s?s:e.ToggleMenuPush.defaults.layout}return this.settings.layout},addItemContent:function(t){var s=this;if("panel"===t.layout){var n=null;if(void 0!==s.elements.back)n=s.elements.back;else{n=e("<li>",{class:s.settings.classes.back}),e("<button>",{class:"item-btn"}).appendTo(n);var i=e("<span>",{class:"item-title",html:s.elements.itemLink(t).text()}).appendTo(n);s.settings.backLink&&i.wrapInner(e("<a>",{href:s.elements.itemLink(t).attr("href")}))}null!==n&&(n.prependTo(s.elements.itemContent(t)),s.elements.backBtn(n).on("click.togglemenu.backBtn",function(){s.toggleSubmenu(t)}),void 0!==s.settings.onAddItemContent&&s.settings.onAddItemContent.call({ToggleMenuPush:s,item:t,itemContent:n}))}},toggle:function(){var e=this;e.ToggleMenu.elements.body.toggleClass(e.settings.classes.open),e.isOpen=e.ToggleMenu.elements.body.hasClass(e.settings.classes.open),setTimeout(function(){e.isOpen?e.elements.page.on(e.events.page="click touchstart",function(t){t.preventDefault(),e.isOpen&&e.toggle()}):(e.elements.page.off(e.events.page),e.closeSubmenus())},0),void 0!==e.settings.onToggle&&e.settings.onToggle.call({ToggleMenuPush:e,body:e.ToggleMenu.elements.body,page:e.elements.page,isOpen:e.isOpen})},toggleSubmenu:function(e){this.closeSubmenus(e),e.toggleClass(this.settings.classes.active),void 0!==e.layout&&"panel"===e.layout&&(this.elements.wrapper.scrollTop(0),this.ToggleMenu.elements.body.toggleClass(this.settings.classes.submenuOpen)),void 0!==this.settings.onToggleSubmenu&&this.settings.onToggleSubmenu.call({ToggleMenuPush:this,item:e})},closeSubmenus:function(e){var t=void 0!==e?e.siblings("."+this.settings.classes.active):this.elements.items,s=t.find("."+this.settings.classes.active);if(t.length&&(t.removeClass(this.settings.classes.active),this.ToggleMenu.elements.body.hasClass(this.settings.classes.submenuOpen)&&this.ToggleMenu.elements.body.removeClass(this.settings.classes.submenuOpen)),s.length&&s.removeClass(this.settings.classes.active),void 0!==e){var n=e.find("."+this.settings.classes.active);n.length&&n.removeClass(this.settings.classes.active)}},unload:function(){var t=this;t.isOpen&&t.toggle(),t.unWrap(),e.each(t.events,function(e,s){t.elements[e].off(s)}),t.elements.items.each(function(){var s=e(this);t.elements.itemLink(s).off("click.togglemenu.itemLink"),void 0!==t.elements.back&&t.elements.backBtn(s).off("click.togglemenu.backBtn")}),e.each(t.elements.content,function(e,s){"close"!==e&&s.removeClass(t.settings.classes.copy)})}}}(jQuery);