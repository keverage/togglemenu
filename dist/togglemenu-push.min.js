!function(e){"use strict";e.ToggleMenuPush=function(t,n){this.ToggleMenu=t,e.extend(!0,this.settings={},this.ToggleMenu.settings,e.ToggleMenuPush.defaults,n),this.elements=this.settings.elements,delete this.settings.elements,this.events={},this.isOpen=!1,this.prepareOptions()&&this.load()},e.ToggleMenuPush.defaults={elements:{content:{menu:void 0},items:void 0,itemLink:function(e){return e.children("a")},itemContent:function(e){return e.children("ul")},toggle:void 0,page:void 0,back:void 0,backBtn:function(e){return e.children("button")}},layout:"accordion",backLink:!1,classes:{open:"is-{prefix}Open",active:"is-active",copy:"{prefix}-copy",back:"item-back"},onLoad:void 0,beforeWrap:void 0,onAddContent:void 0,afterEventsHandler:void 0,afterItemHandler:void 0,onAddItemContent:void 0,onComplete:void 0,onToggle:void 0,onToggleSubmenu:void 0},e.ToggleMenuPush.prototype={prepareOptions:function(){return this.ToggleMenu.replacePrefixClass.call(this),void 0===this.elements.toggle&&(this.elements.toggle=e("."+this.settings.classes.prefix+"-toggle"),0===this.elements.toggle.length)?(this.ToggleMenu.setLog("error","Missing elements.toggle parameter"),!1):void 0===this.elements.content.menu?(this.ToggleMenu.setLog("error","Missing element.content.menu parameter"),!1):void 0!==this.elements.page||(this.elements.page=this.ToggleMenu.elements.body.children("div:first"),0!==this.elements.page.length)||(this.ToggleMenu.setLog("error","Missing element.page parameter"),!1)},load:function(){void 0!==this.settings.onLoad&&this.settings.onLoad.call({ToggleMenuPush:this}),this.wrap(),this.addContent(),this.eventsHandler(),this.itemsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({ToggleMenuPush:this,elements:this.elements,wrapper:this.elements.wrapper})},wrap:function(){this.elements.wrapper=e("<nav>",{class:"nav nav--"+this.settings.classes.prefix+"Push"}),void 0!==this.settings.beforeWrap&&this.settings.beforeWrap.call({ToggleMenuPush:this,wrapper:this.elements.wrapper}),this.elements.wrapper.appendTo(this.ToggleMenu.elements.body)},unWrap:function(){this.elements.wrapper.remove()},addContent:function(){var t=this;e.each(t.elements.content,function(n,s){var i=null;"close"===n?i=e("<button>",{html:s}):"object"==typeof s&&s.length&&(i=s.clone(),s.addClass(t.settings.classes.copy)),void 0!==i&&null!==i&&(i.appendTo(t.elements.wrapper),i.wrap(e("<div>",{class:t.settings.classes.prefix+"-"+n})),"close"!==n&&"menu"!==n||(t.elements[n+"Content"]=i,t.elements[n]=i.parent()),"menu"===n&&(void 0===t.elements.items?t.elements.items=t.ToggleMenu.getItemsParent(i.find("li")):"function"==typeof t.elements.items&&(t.elements.items=t.elements.items(i)))),void 0!==t.settings.onAddContent&&t.settings.onAddContent.call({ToggleMenuPush:t,type:n,element:s,content:i,contentWrapper:t.elements[n]})})},eventsHandler:function(){var e=this;e.elements.toggle.on(e.events.toggle="click.togglemenu.toggle",function(){e.toggle()}),void 0!==e.elements.closeContent&&e.elements.closeContent.on(e.events.closeContent="click.togglemenu.close",function(){e.toggle()}),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({ToggleMenuPush:e,elements:e.elements,events:e.events})},itemsHandler:function(){var t=this;t.elements.items.length&&t.elements.items.each(function(){var n=e(this);n.layout=t.getItemLayout(n),n.addClass("l-"+n.layout),t.addItemContent(n),t.elements.itemLink(n).on("click.togglemenu.itemLink",function(e){e.preventDefault(),t.toggleSubmenu(n)}),void 0!==t.settings.afterItemHandler&&t.settings.afterItemHandler.call({ToggleMenuPush:t,elements:t.elements,item:n})})},getItemLayout:function(t){if("data"===this.settings.layout&&void 0!==t){var n=t.attr("data-layout");return void 0!==n||""!==n?n:e.ToggleMenuPush.defaults.layout}return this.settings.layout},addItemContent:function(t){var n=this;if("panel"===t.layout){var s=null;if(void 0!==n.elements.back)s=n.elements.back;else{s=e("<li>",{class:n.settings.classes.back}),e("<button>",{class:"item-btn"}).appendTo(s);var i=e("<span>",{class:"item-title",html:n.elements.itemLink(t).text()}).appendTo(s);n.settings.backLink&&i.wrapInner(e("<a>",{href:n.elements.itemLink(t).attr("href")}))}null!==s&&(s.prependTo(n.elements.itemContent(t)),n.elements.backBtn(s).on("click.togglemenu.backBtn",function(){n.toggleSubmenu(t)}),void 0!==n.settings.onAddItemContent&&n.settings.onAddItemContent.call({ToggleMenuPush:n,item:t,itemContent:s}))}},toggle:function(){var e=this;e.ToggleMenu.elements.body.toggleClass(e.settings.classes.open),e.isOpen=e.ToggleMenu.elements.body.hasClass(e.settings.classes.open),setTimeout(function(){e.isOpen?e.elements.page.on(e.events.page="click touchstart",function(t){t.preventDefault(),e.isOpen&&e.toggle()}):(e.elements.page.off(e.events.page),e.closeSubmenus())},0),void 0!==e.settings.onToggle&&e.settings.onToggle.call({ToggleMenuPush:e,body:e.ToggleMenu.elements.body,page:e.elements.page,isOpen:e.isOpen})},toggleSubmenu:function(e){this.closeSubmenus(e),e.toggleClass(this.settings.classes.active),void 0!==this.settings.onToggleSubmenu&&this.settings.onToggleSubmenu.call({ToggleMenuPush:this,item:e})},closeSubmenus:function(e){var t=void 0!==e?e.siblings("."+this.settings.classes.active):this.elements.items,n=t.find("."+this.settings.classes.active);if(t.length&&t.removeClass(this.settings.classes.active),n.length&&n.removeClass(this.settings.classes.active),void 0!==e){var s=e.find("."+this.settings.classes.active);s.length&&s.removeClass(this.settings.classes.active)}},unload:function(){var t=this;t.isOpen&&t.toggle(),t.unWrap(),e.each(t.events,function(e,n){t.elements[e].off(n)}),t.elements.items.each(function(){var n=e(this);t.elements.itemLink(n).off("click.togglemenu.itemLink"),void 0!==t.elements.back&&t.elements.backBtn(n).off("click.togglemenu.backBtn")}),e.each(t.elements.content,function(e,n){"close"!==e&&n.removeClass(t.settings.classes.copy)})}}}(jQuery);