!function(l){"use strict";l.ToggleMenuOverlay=function(e,t){return this.toggleMenu=e,l.extend(l.ToggleMenuOverlay.prototype,l.ToggleMenu.prototype),l.extend(!0,this.settings={},this.toggleMenu.settings,l.ToggleMenuOverlay.defaults,t),this.elements=l.extend(!0,{body:l("body")},this.settings.elements),delete this.settings.elements,this.events={},this.prepareUserOptions()&&this.load(),this},l.ToggleMenuOverlay.defaults={elements:{content:{menu:void 0},items:void 0,itemLink:function(e){return e.children("a")},toggle:void 0},closeOnEscape:!0,classes:{copy:"{prefix}-copy"},beforeLoad:void 0,beforeWrap:void 0,onAddContent:void 0,afterEventsHandler:void 0,afterItemHandler:void 0,onComplete:void 0,onToggle:void 0,onToggleSubmenu:void 0},l.ToggleMenuOverlay.prototype={prepareUserOptions:function(){return this.replacePrefixClass(),void 0===this.getElements().toggle&&(this.elements.toggle=l("."+this.settings.classes.prefix+"-toggle"),0===this.getElements().toggle.length)?(this.setLog("Missing elements.toggle parameter","error"),!1):void 0!==this.getContentElements().menu||(this.setLog("Missing elements.content.menu parameter","error"),!1)},load:function(){return void 0!==this.settings.beforeLoad&&this.settings.beforeLoad.call({toggleMenuOverlay:this}),this.wrap(),this.addContent(),this.eventsHandler(),this.itemsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({toggleMenuOverlay:this,elements:this.getElements()}),this},unload:function(){var s=this;return s.isOpen&&s.toggle(),s.unWrap(),l.each(s.events,function(e,t){void 0!==s.getElements()[e]&&s.getElements()[e].off(t)}),null!==s.getElements().itemLink&&s.getElements().items.each(function(e,t){s.getElements().itemLink(l(t)).off("click.togglemenuOverlay")}),l(document).off("keydown.togglemenuOverlay"),l.each(s.getContentElements(),function(e,t){"close"!==e&&t.removeClass(s.settings.classes.copy)}),s},wrap:function(){return this.elements.wrapper=l("<nav>",{class:this.settings.classes.prefix+" "+this.settings.classes.prefix+"--"+this.toggleMenu.menu.current}),void 0!==this.settings.beforeWrap&&this.settings.beforeWrap.call({toggleMenuOverlay:this,wrapper:this.getWrapper()}),this.getWrapper().appendTo(this.getElements().body),this},unWrap:function(){return this.getWrapper().remove(),this},addContent:function(){var n=this;return l.each(n.getContentElements(),function(e,t){var s=null;"close"===e?s=l("<button>",{html:t}):"object"==typeof t&&t.length&&((s=t.clone()).removeAttr("id"),t.addClass(n.settings.classes.copy)),null!=s&&(s.appendTo(n.getWrapper()),s.wrap(l("<div>",{class:n.settings.classes.prefix+"-"+e})),"close"!==e&&"menu"!==e||(n.elements[e+"Content"]=s,n.elements[e]=s.parent()),"menu"===e&&(void 0===n.getElements().items?n.elements.items=n.getItemsParent(s.find("li")):"function"==typeof n.getElements().items&&(n.elements.items=n.getElements().items(s)))),void 0!==n.settings.onAddContent&&n.settings.onAddContent.call({toggleMenuOverlay:n,type:e,element:t,content:s,contentWrapper:n.getElements()[e]})}),n},eventsHandler:function(){var e=this;return e.getElements().toggle.on(e.events.toggle="click.togglemenuOverlay",{self:e},e.toggle),void 0!==e.getElements().closeContent&&e.getElements().closeContent.on(e.events.closeContent="click.togglemenuOverlay",{self:e},e.toggle),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({toggleMenuOverlay:e,elements:e.getElements(),events:e.events}),e},itemsHandler:function(){var s=this;return s.getElements().items.length&&s.getElements().items.each(function(e,t){t=l(t),null!==s.getElements().itemLink&&s.getElements().itemLink(t).on("click.togglemenuOverlay",function(e){e.preventDefault(),s.isOpen||s.toggle(),s.toggleSubmenu(t)}),void 0!==s.settings.afterItemHandler&&s.settings.afterItemHandler.call({toggleMenuOverlay:s,elements:s.getElements(),item:t})}),s},toggle:function(e){var t=void 0!==e&&void 0!==e.data&&void 0!==e.data.self?e.data.self:this;return t.getElements().body.toggleClass(t.settings.classes.open),t.isOpen=t.getElements().body.hasClass(t.settings.classes.open),t.isOpen||(t.closeSubmenus(),l(document).off("keydown.togglemenuOverlay")),t.settings.closeOnEscape&&t.isOpen&&l(document).one("keydown.togglemenuOverlay",function(e){27===e.keyCode&&t.toggle()}),void 0!==t.settings.onToggle&&t.settings.onToggle.call({toggleMenuOverlay:t,isOpen:t.isOpen}),t},toggleSubmenu:function(e){return this.closeSubmenus(e),e.toggleClass(this.settings.classes.active),void 0!==this.settings.onToggleSubmenu&&this.settings.onToggleSubmenu.call({toggleMenuOverlay:this,item:e}),this},closeSubmenus:function(e){var t,s=void 0!==e?e.siblings("."+this.settings.classes.active):this.getElements().items,n=s.find("."+this.settings.classes.active);return s.length&&s.removeClass(this.settings.classes.active),n.length&&n.removeClass(this.settings.classes.active),void 0===e||(t=e.find("."+this.settings.classes.active)).length&&t.removeClass(this.settings.classes.active),this}}}(jQuery);