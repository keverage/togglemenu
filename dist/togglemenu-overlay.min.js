!function(e){"use strict";e.ToggleMenuOverlay=function(t,s){this.ToggleMenu=t,e.extend(!0,this.settings={},this.ToggleMenu.settings,e.ToggleMenuOverlay.defaults,s),this.elements=this.settings.elements,delete this.settings.elements,this.events={},this.prepareOptions()&&this.load()},e.ToggleMenuOverlay.defaults={elements:{content:{menu:void 0},items:void 0,itemLink:function(e){return e.children("a")},toggle:void 0},closeOnEscape:!0,classes:{open:"is-{prefix}Open",active:"is-active",copy:"{prefix}-copy"},onLoad:void 0,beforeWrap:void 0,onAddContent:void 0,afterEventsHandler:void 0,afterItemHandler:void 0,onComplete:void 0,onToggle:void 0,onToggleSubmenu:void 0},e.ToggleMenuOverlay.prototype={prepareOptions:function(){return this.ToggleMenu.replacePrefixClass.call(this),void 0===this.elements.toggle&&(this.elements.toggle=e("."+this.settings.classes.prefix+"-toggle"),0===this.elements.toggle.length)?(this.ToggleMenu.setLog("error","Missing elements.toggle parameter"),!1):void 0!==this.elements.content.menu||(this.ToggleMenu.setLog("error","Missing elements.content.menu parameter"),!1)},load:function(){void 0!==this.settings.onLoad&&this.settings.onLoad.call({ToggleMenuOverlay:this}),this.wrap(),this.addContent(),this.eventsHandler(),this.itemsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({ToggleMenuOverlay:this,elements:this.elements})},wrap:function(){this.elements.wrapper=e("<nav>",{class:"nav nav--"+this.settings.classes.prefix+"Overlay"}),void 0!==this.settings.beforeWrap&&this.settings.beforeWrap.call({ToggleMenuOverlay:this,wrapper:this.elements.wrapper}),this.elements.wrapper.appendTo(this.ToggleMenu.elements.body)},unWrap:function(){this.elements.wrapper.remove()},addContent:function(){var t=this;e.each(t.elements.content,function(s,n){var i=null;"object"==typeof n&&n.length&&((i=n.clone()).removeAttr("id"),n.addClass(t.settings.classes.copy)),void 0!==i&&null!==i&&(i.appendTo(t.elements.wrapper),i.wrap(e("<div>",{class:t.settings.classes.prefix+"-"+s})),"menu"===s&&(t.elements[s+"Content"]=i,t.elements[s]=i.parent(),void 0===t.elements.items?t.elements.items=t.ToggleMenu.getItemsParent(i.find("li")):"function"==typeof t.elements.items&&(t.elements.items=t.elements.items(i)))),void 0!==t.settings.onAddContent&&t.settings.onAddContent.call({ToggleMenuOverlay:t,type:s,element:n,content:i,contentWrapper:t.elements[s]})})},eventsHandler:function(){var e=this;e.elements.toggle.on(e.events.toggle="click.togglemenu.toggle",function(){e.toggle()}),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({ToggleMenuOverlay:e,elements:e.elements,events:e.events})},itemsHandler:function(){var t=this;t.elements.items.length&&t.elements.items.each(function(){var s=e(this);null!==t.elements.itemLink&&t.elements.itemLink(s).on("click.togglemenu.itemLink",function(e){e.preventDefault(),t.isOpen||t.toggle(),t.toggleSubmenu(s)}),void 0!==t.settings.afterItemHandler&&t.settings.afterItemHandler.call({ToggleMenuOverlay:t,elements:t.elements,item:s})})},toggle:function(){var t=this;t.ToggleMenu.elements.body.toggleClass(t.settings.classes.open),t.isOpen=t.ToggleMenu.elements.body.hasClass(t.settings.classes.open),t.isOpen||(t.closeSubmenus(),e(document).off("keyup.togglemenuOverlay")),t.settings.closeOnEscape&&t.isOpen&&e(document).one("keyup.togglemenuOverlay",function(e){27===e.keyCode&&t.toggle()}),void 0!==this.settings.onToggle&&this.settings.onToggle.call({ToggleMenuOverlay:this,body:this.ToggleMenu.elements.body,isOpen:this.isOpen})},toggleSubmenu:function(e){this.closeSubmenus(e),e.toggleClass(this.settings.classes.active),void 0!==this.settings.onToggleSubmenu&&this.settings.onToggleSubmenu.call({ToggleMenuOverlay:this,item:e})},closeSubmenus:function(e){var t=void 0!==e?e.siblings("."+this.settings.classes.active):this.elements.items,s=t.find("."+this.settings.classes.active);if(t.length&&t.removeClass(this.settings.classes.active),s.length&&s.removeClass(this.settings.classes.active),void 0!==e){var n=e.find("."+this.settings.classes.active);n.length&&n.removeClass(this.settings.classes.active)}},unload:function(){var t=this;t.isOpen&&t.toggle(),t.unWrap(),e.each(t.events,function(e,s){t.elements[e].off(s)}),null!==t.elements.itemLink&&t.elements.items.each(function(){t.elements.itemLink(e(this)).off("click.togglemenu.itemLink")}),e(document).off("keyup.togglemenuOverlay"),e.each(t.elements.content,function(e,s){s.removeClass(t.settings.classes.copy)})}}}(jQuery);