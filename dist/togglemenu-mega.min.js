!function(n){"use strict";n.ToggleMenuMega=function(e,t){return this.toggleMenu=e,n.extend(!0,this.settings={},this.toggleMenu.settings,n.ToggleMenuMega.defaults,t),this.elements=this.settings.elements,delete this.settings.elements,this.events={},!!this.prepareOptions()&&this.load()},n.ToggleMenuMega.defaults={elements:{menu:void 0,items:void 0,itemLink:function(e){return e.children("a")},close:void 0},overlay:!0,closeOnEscape:!0,classes:{open:"is-{prefix}Open",active:"is-active"},onLoad:void 0,beforeAddOverlay:void 0,afterEventsHandler:void 0,afterItemHandler:void 0,onComplete:void 0,onToggleSubmenu:void 0},n.ToggleMenuMega.prototype={prepareOptions:function(){return this.toggleMenu.replacePrefixClass.call(this),void 0===this.elements.menu?(this.toggleMenu.setLog("error","Missing elements.menu parameter"),!1):void 0!==this.elements.items||(this.toggleMenu.setLog("error","Missing elements.items parameter"),!1)},load:function(){return void 0!==this.settings.onLoad&&this.settings.onLoad.call({toggleMenuMega:this}),this.settings.overlay&&this.addOverlay(),this.eventsHandler(),this.itemsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({toggleMenuMega:this,elements:this.elements}),this},addOverlay:function(){return this.elements.overlay=n("<div>",{class:this.settings.classes.prefix+"Mega-overlay"}),void 0!==this.settings.beforeAddOverlay&&this.settings.beforeAddOverlay.call({toggleMenuMega:this,overlay:this.elements.overlay}),this.elements.overlay.appendTo(this.toggleMenu.elements.body),this},removeOverlay:function(){return this.elements.overlay.remove(),this},eventsHandler:function(){var e=this;return void 0!==e.elements.close&&e.elements.close.on(e.events.close="click.togglemenu.close",function(){e.toggleSubmenu()}),e.settings.overlay&&e.elements.overlay.on(e.events.overlay="click.togglemenu.overlay",function(){e.toggleSubmenu()}),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({toggleMenuMega:e,elements:e.elements,events:e.events}),e},itemsHandler:function(){var s=this;return s.elements.items.length&&s.elements.items.each(function(e,t){t=n(t),s.elements.itemLink(t).on("click.togglemenu.itemLink",function(e){e.preventDefault(),s.toggleSubmenu(t)}),void 0!==s.settings.afterItemHandler&&s.settings.afterItemHandler.call({toggleMenuMega:s,elements:s.elements,item:t})}),s},toggleSubmenu:function(e){var t=this;return t.closeSubmenus(e),void 0!==e&&(e.toggleClass(t.settings.classes.active),t.settings.overlay&&t.toggleMenu.elements.body.toggleClass(t.settings.classes.open),t.settings.closeOnEscape&&n(document).one("keyup.togglemenuMega",function(e){27===e.keyCode&&t.toggleSubmenu()})),void 0!==t.settings.onToggleSubmenu&&t.settings.onToggleSubmenu.call({toggleMenuMega:t,item:e}),t},closeSubmenus:function(e){var t=void 0!==e?e.siblings("."+this.settings.classes.active):this.elements.items,s=t.find("."+this.settings.classes.active);if(t.length&&(t.removeClass(this.settings.classes.active),this.settings.overlay&&this.toggleMenu.elements.body.removeClass(this.settings.classes.open)),s.length&&s.removeClass(this.settings.classes.active),void 0!==e){var n=e.find("."+this.settings.classes.active);n.length&&n.removeClass(this.settings.classes.active)}return this},unload:function(){var s=this;return s.settings.overlay&&s.removeOverlay(),n.each(s.events,function(e,t){s.elements[e].off(t)}),s.elements.items.each(function(e,t){s.elements.itemLink(n(t)).off("click.togglemenu.itemLink")}),n(document).off("keyup.togglemenuMega"),s}}}(jQuery);