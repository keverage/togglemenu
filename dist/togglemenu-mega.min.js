!function(n){"use strict";n.ToggleMenuMega=function(e,t){return this.toggleMenu=e,n.extend(n.ToggleMenuMega.prototype,n.ToggleMenu.prototype),n.extend(!0,this.settings={},this.toggleMenu.settings,n.ToggleMenuMega.defaults,t),this.elements=n.extend(!0,{body:n("body")},this.settings.elements),delete this.settings.elements,this.events={},this.prepareUserOptions()&&this.load(),this},n.ToggleMenuMega.defaults={elements:{menu:void 0,items:void 0,itemLink:function(e){return e.children("a")},close:void 0},overlay:!0,closeOnEscape:!0,classes:{overlay:"{prefix}-overlay"},beforeLoad:void 0,beforeAddOverlay:void 0,afterEventsHandler:void 0,afterItemHandler:void 0,onComplete:void 0,onToggleSubmenu:void 0},n.ToggleMenuMega.prototype={prepareUserOptions:function(){return this.replacePrefixClass(),void 0===this.getElements().menu?(this.setLog("Missing elements.menu parameter","error"),!1):void 0!==this.getElements().items||(this.setLog("Missing elements.items parameter","error"),!1)},load:function(){return void 0!==this.settings.beforeLoad&&this.settings.beforeLoad.call({toggleMenuMega:this}),this.settings.overlay&&this.addOverlay(),this.eventsHandler(),this.itemsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({toggleMenuMega:this,elements:this.getElements()}),this},unload:function(){var s=this;return s.settings.overlay&&s.removeOverlay(),n.each(s.events,function(e,t){void 0!==s.getElements()[e]&&s.getElements()[e].off(t)}),s.getElements().items.each(function(e,t){s.getElements().itemLink(n(t)).off("click.togglemenuMega")}),n(document).off("keyup.togglemenuMega"),s},addOverlay:function(){return this.elements.overlay=n("<div>",{class:this.settings.classes.overlay}),void 0!==this.settings.beforeAddOverlay&&this.settings.beforeAddOverlay.call({toggleMenuMega:this,overlay:this.getElements().overlay}),this.getElements().overlay.appendTo(this.getElements().body),this},removeOverlay:function(){return this.getElements().overlay.remove(),this},eventsHandler:function(){var e=this;return void 0!==e.getElements().close&&e.getElements().close.on(e.events.close="click.togglemenuMega",{self:e},e.toggleSubmenu),e.settings.overlay&&e.getElements().overlay.on(e.events.overlay="click.togglemenuMega",{self:e},e.toggleSubmenu),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({toggleMenuMega:e,elements:e.getElements(),events:e.events}),e},itemsHandler:function(){var s=this;return s.getElements().items.length&&s.getElements().items.each(function(e,t){t=n(t),s.getElements().itemLink(t).on("click.togglemenuMega",function(e){e.preventDefault(),s.toggleSubmenu(t)}),void 0!==s.settings.afterItemHandler&&s.settings.afterItemHandler.call({toggleMenuMega:s,elements:s.getElements(),item:t})}),s},toggleSubmenu:function(e){var t=this;return void 0!==e&&void 0!==e.data&&void 0!==e.data.self&&(t=e.data.self,e=void 0),t.closeSubmenus(e),void 0!==e&&(e.toggleClass(t.settings.classes.active),t.settings.overlay&&t.getElements().body.toggleClass(t.settings.classes.open),t.settings.closeOnEscape&&n(document).one("keyup.togglemenuMega",function(e){27===e.keyCode&&t.toggleSubmenu()})),void 0!==t.settings.onToggleSubmenu&&t.settings.onToggleSubmenu.call({toggleMenuMega:t,item:e}),t},closeSubmenus:function(e){var t,s=void 0!==e?e.siblings("."+this.settings.classes.active):this.getElements().items,n=s.find("."+this.settings.classes.active);return s.length&&(s.removeClass(this.settings.classes.active),this.settings.overlay&&this.getElements().body.removeClass(this.settings.classes.open)),n.length&&n.removeClass(this.settings.classes.active),void 0===e||(t=e.find("."+this.settings.classes.active)).length&&t.removeClass(this.settings.classes.active),this}}}(jQuery);